<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Database Verification</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 20px; 
      background: #f5f5f5;
    }
    .section { 
      background: white; 
      margin: 20px 0; 
      padding: 20px; 
      border-radius: 8px; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .result { 
      margin: 10px 0; 
      padding: 10px; 
      border-radius: 5px; 
      border-left: 4px solid #ccc;
    }
    .success { background: #d4edda; border-color: #28a745; color: #155724; }
    .error { background: #f8d7da; border-color: #dc3545; color: #721c24; }
    .info { background: #d1ecf1; border-color: #17a2b8; color: #0c5460; }
    .warning { background: #fff3cd; border-color: #ffc107; color: #856404; }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
      font-size: 16px;
    }
    button:hover { background: #0056b3; }
    button.success { background: #28a745; }
    button.danger { background: #dc3545; }
    .collection-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
    }
    .collection-table th, .collection-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    .collection-table th {
      background: #f8f9fa;
    }
    pre {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      max-height: 300px;
      overflow-y: auto;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>üîç Firebase Database Verification</h1>
  <p>Check what's actually in your Firebase database and create missing data.</p>
  
  <div class="section">
    <h3>üîç Database Status</h3>
    <button onclick="checkAllCollections()">üìä Check All Collections</button>
    <button onclick="createAdminAccounts()" class="success">üë®‚Äçüíº Create Admin Accounts</button>
    <button onclick="forceCreateAllData()" class="success">üí™ FORCE CREATE ALL DATA</button>
    <button onclick="clearResults()" class="danger">üßπ Clear Results</button>
    
    <div id="currentUser" class="result info">
      <strong>Current User:</strong> <span id="userInfo">Checking...</span>
    </div>
  </div>

  <div class="section">
    <h3>üìä Collection Status</h3>
    <table class="collection-table" id="collectionsTable">
      <thead>
        <tr>
          <th>Collection</th>
          <th>Document Count</th>
          <th>Status</th>
          <th>Sample Documents</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="4">Click "Check All Collections" to scan database...</td></tr>
      </tbody>
    </table>
  </div>
  
  <div id="results"></div>

  <!-- Firebase Config -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getAuth, signInAnonymously, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, collection, query, getDocs, addDoc, serverTimestamp, writeBatch } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDHpZ1mcn4qkgWW1BQcu6HQ8FM5LYA59aA",
      authDomain: "putnam-county-home-show-130cb.firebaseapp.com",
      projectId: "putnam-county-home-show-130cb",
      storageBucket: "putnam-county-home-show-130cb.firebasestorage.app",
      messagingSenderId: "1085199568795",
      appId: "1:1085199568795:web:61527ae4d08c2cb802db3e"
    };

    let app, auth, db, currentUser;

    function log(message, type = 'info') {
      addResult(message, type);
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    function addResult(message, type = 'info') {
      const results = document.getElementById('results');
      const div = document.createElement('div');
      div.className = `result ${type}`;
      div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
      results.appendChild(div);
      results.scrollTop = results.scrollHeight;
    }

    function updateUserInfo() {
      const userInfo = document.getElementById('userInfo');
      if (currentUser) {
        userInfo.textContent = `${currentUser.email || 'Anonymous'} (${currentUser.uid.substring(0, 8)}...)`;
      } else {
        userInfo.textContent = 'Not authenticated';
      }
    }

    async function initializeFirebase() {
      try {
        app = initializeApp(firebaseConfig);
        auth = getAuth(app);
        db = getFirestore(app);
        
        onAuthStateChanged(auth, (user) => {
          currentUser = user;
          updateUserInfo();
        });
        
        await signInAnonymously(auth);
        log('‚úÖ Firebase initialized and authenticated', 'success');
        
        return true;
      } catch (error) {
        log(`‚ùå Firebase initialization failed: ${error.message}`, 'error');
        return false;
      }
    }

    window.checkAllCollections = async function() {
      log('üîç Scanning all Firebase collections...', 'info');
      
      const collections = [
        'vendors', 'attendees', 'leads', 'users', 'public',
        'landing-templates', 'card-traffic', 'landing-page-configs', 
        'admin-config', 'admin-analytics', 'events', 'contests',
        'analytics', 'messages', 'promotions', 'notifications', 'maps'
      ];
      
      const tableBody = document.querySelector('#collectionsTable tbody');
      tableBody.innerHTML = '';
      
      let totalDocs = 0;
      
      for (const collectionName of collections) {
        try {
          const q = query(collection(db, collectionName));
          const querySnapshot = await getDocs(q);
          const docCount = querySnapshot.size;
          totalDocs += docCount;
          
          const row = tableBody.insertRow();
          row.insertCell(0).textContent = collectionName;
          row.insertCell(1).textContent = docCount;
          
          const statusCell = row.insertCell(2);
          if (docCount > 0) {
            statusCell.innerHTML = '<span style="color: green;">‚úÖ Has Data</span>';
          } else {
            statusCell.innerHTML = '<span style="color: red;">‚ùå Empty</span>';
          }
          
          const sampleCell = row.insertCell(3);
          if (docCount > 0) {
            const sampleDocs = [];
            let count = 0;
            querySnapshot.forEach((doc) => {
              if (count < 3) {
                sampleDocs.push(doc.id);
                count++;
              }
            });
            sampleCell.textContent = sampleDocs.join(', ');
          } else {
            sampleCell.textContent = 'No documents';
          }
          
        } catch (error) {
          const row = tableBody.insertRow();
          row.insertCell(0).textContent = collectionName;
          row.insertCell(1).textContent = 'ERROR';
          row.insertCell(2).innerHTML = '<span style="color: red;">‚ùå Access Denied</span>';
          row.insertCell(3).textContent = error.message;
          
          log(`‚ùå Cannot access ${collectionName}: ${error.message}`, 'error');
        }
      }
      
      log(`üìä Scan complete: ${totalDocs} total documents found`, totalDocs > 0 ? 'success' : 'warning');
    };

    window.createAdminAccounts = async function() {
      log('üë®‚Äçüíº Creating admin accounts...', 'info');
      
      // Create admin user document for current user
      if (currentUser) {
        try {
          const adminUserRef = doc(db, 'users', currentUser.uid);
          const adminUserData = {
            role: 'organizer',
            email: 'andrew@houseofkna.com',
            permissions: {
              manageVendors: true,
              viewAllCardTraffic: true,
              viewAnalytics: true,
              sendNotifications: true,
              moderateContent: true,
              exportData: true,
              manageUsers: true
            },
            profile: {
              name: 'Andrew Loftis',
              title: 'Event Organizer',
              phone: '+1-555-0000'
            },
            preferences: {
              theme: 'light',
              notifications: true,
              language: 'en',
              timezone: 'America/New_York'
            },
            stats: {
              loginCount: 1,
              lastLogin: serverTimestamp(),
              actionsPerformed: 0
            },
            createdAt: serverTimestamp(),
            updatedAt: serverTimestamp()
          };
          
          await setDoc(adminUserRef, adminUserData);
          log('‚úÖ Created admin user account', 'success');
          
        } catch (error) {
          log(`‚ùå Failed to create admin user: ${error.message}`, 'error');
        }
      }
      
      // Create additional admin accounts list
      try {
        const adminListRef = doc(db, 'admin-config', 'admin-users');
        const adminListData = {
          admins: [
            {
              uid: currentUser?.uid || 'admin',
              email: 'andrew@houseofkna.com',
              role: 'super_admin',
              permissions: 'all',
              active: true,
              createdAt: new Date().toISOString()
            }
          ],
          roles: {
            super_admin: {
              description: 'Full system access',
              permissions: ['all']
            },
            organizer: {
              description: 'Event management access',
              permissions: ['manage_vendors', 'view_analytics', 'send_notifications']
            },
            moderator: {
              description: 'Content moderation access',
              permissions: ['moderate_content', 'view_reports']
            }
          },
          updatedAt: serverTimestamp()
        };
        
        await setDoc(adminListRef, adminListData);
        log('‚úÖ Created admin configuration', 'success');
        
      } catch (error) {
        log(`‚ùå Failed to create admin config: ${error.message}`, 'error');
      }
    };

    window.forceCreateAllData = async function() {
      log('üí™ FORCE CREATING ALL MISSING DATA...', 'info');
      
      try {
        // Create vendors
        await createVendors();
        
        // Create attendees
        await createAttendees();
        
        // Create leads
        await createLeads();
        
        // Create public data
        await createPublicData();
        
        // Create landing page system
        await createLandingPageSystem();
        
        // Create admin tracking
        await createAdminTracking();
        
        // Create admin accounts
        await createAdminAccounts();
        
        log('üéâ ALL DATA FORCE CREATED SUCCESSFULLY!', 'success');
        
        // Refresh the table
        setTimeout(() => {
          checkAllCollections();
        }, 2000);
        
      } catch (error) {
        log(`‚ùå Force creation failed: ${error.message}`, 'error');
      }
    };

    async function createVendors() {
      const vendors = [
        {
          id: 'kitchen-pro-001',
          name: 'Kitchen Pro Design Studio',
          category: 'Kitchen',
          booth: 'A1',
          contactEmail: 'info@kitchenpro.com',
          contactPhone: '+1-555-0101',
          approved: true,
          verified: true,
          featured: true,
          ownerUid: currentUser?.uid || 'admin',
          profile: {
            description: 'Award-winning kitchen design and renovation specialists',
            tagline: 'Transform Your Kitchen Dreams Into Reality',
            specialOffer: '15% off complete kitchen renovations!',
            website: 'https://kitchenpro.com',
            services: ['Kitchen Design', 'Full Renovation', 'Cabinet Installation'],
            priceRange: '$$'
          },
          landingPage: {
            enabled: true,
            slug: 'kitchen-pro-design',
            template: 'modern',
            viewCount: 0,
            leadCount: 0
          },
          rating: 4.8,
          reviewCount: 127,
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        },
        {
          id: 'solar-solutions-001',
          name: 'Eco Solar Solutions',
          category: 'Solar',
          booth: 'B3',
          contactEmail: 'contact@ecosolar.com',
          contactPhone: '+1-555-0202',
          approved: true,
          verified: true,
          featured: false,
          ownerUid: currentUser?.uid || 'admin',
          profile: {
            description: 'Leading solar panel installation and energy solutions',
            specialOffer: 'Free solar assessment and $500 off installation!',
            website: 'https://ecosolar.com',
            services: ['Solar Installation', 'Energy Audit', 'Maintenance'],
            priceRange: '$$$'
          },
          landingPage: {
            enabled: true,
            slug: 'eco-solar-solutions',
            template: 'professional',
            viewCount: 0,
            leadCount: 0
          },
          rating: 4.9,
          reviewCount: 89,
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        }
      ];

      for (const vendor of vendors) {
        try {
          const vendorRef = doc(db, 'vendors', vendor.id);
          const { id, ...vendorData } = vendor;
          await setDoc(vendorRef, vendorData);
          log(`‚úÖ Created vendor: ${vendor.name}`, 'success');
        } catch (error) {
          log(`‚ùå Failed to create vendor ${vendor.name}: ${error.message}`, 'error');
        }
      }
    }

    async function createAttendees() {
      const attendees = [
        {
          id: 'attendee-001',
          ownerUid: currentUser?.uid || 'admin',
          name: 'John Smith',
          email: 'john.smith@example.com',
          phone: '+1-555-1001',
          zip: '12345',
          interests: ['Kitchen', 'Bath', 'Solar'],
          shortCode: 'JS001',
          qrData: 'homeshow://attendee/JS001',
          consentEmail: true,
          consentSMS: false,
          savedVendors: ['kitchen-pro-001'],
          card: {
            familySize: 4,
            visitingReasons: ['Kitchen remodel', 'Solar installation'],
            bio: 'Looking to renovate our kitchen and explore solar options.',
            location: 'Springfield, County'
          },
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        }
      ];

      for (const attendee of attendees) {
        try {
          const attendeeRef = doc(db, 'attendees', attendee.id);
          const { id, ...attendeeData } = attendee;
          await setDoc(attendeeRef, attendeeData);
          log(`‚úÖ Created attendee: ${attendee.name}`, 'success');
        } catch (error) {
          log(`‚ùå Failed to create attendee ${attendee.name}: ${error.message}`, 'error');
        }
      }
    }

    async function createLeads() {
      const leads = [
        {
          id: 'lead-001',
          attendeeId: 'attendee-001',
          vendorId: 'kitchen-pro-001',
          createdByUid: currentUser?.uid || 'admin',
          exchangeMethod: 'card_share',
          notes: 'Interested in full kitchen renovation, budget around $30k',
          status: 'new',
          priority: 'high',
          emailSent: false,
          cardShared: true,
          createdAt: serverTimestamp(),
          timestamp: Date.now(),
          updatedAt: serverTimestamp()
        }
      ];

      for (const lead of leads) {
        try {
          const leadRef = doc(db, 'leads', lead.id);
          const { id, ...leadData } = lead;
          await setDoc(leadRef, leadData);
          log(`‚úÖ Created lead: ${lead.id}`, 'success');
        } catch (error) {
          log(`‚ùå Failed to create lead ${lead.id}: ${error.message}`, 'error');
        }
      }
    }

    async function createPublicData() {
      const publicData = [
        {
          id: 'event-info',
          data: {
            eventName: 'Putnam County Home Show 2025',
            eventDate: '2025-10-15',
            eventTime: '9:00 AM - 6:00 PM',
            location: 'Putnam County Fairgrounds',
            address: '123 Fair Street, Putnam, County 12345',
            description: 'The premier home improvement and lifestyle expo in Putnam County.',
            updatedAt: serverTimestamp()
          }
        },
        {
          id: 'categories',
          data: {
            categories: ['Kitchen', 'Bath', 'Landscaping', 'Windows', 'Solar', 'Roofing', 'Flooring', 'HVAC', 'Painting'],
            updatedAt: serverTimestamp()
          }
        }
      ];

      for (const item of publicData) {
        try {
          const docRef = doc(db, 'public', item.id);
          await setDoc(docRef, item.data);
          log(`‚úÖ Created public document: ${item.id}`, 'success');
        } catch (error) {
          log(`‚ùå Failed to create public document ${item.id}: ${error.message}`, 'error');
        }
      }
    }

    async function createLandingPageSystem() {
      // Landing page templates
      const templates = [
        {
          id: 'modern-template',
          name: 'Modern Professional',
          sections: ['hero', 'about', 'services', 'gallery', 'contact'],
          active: true,
          createdAt: serverTimestamp()
        }
      ];

      for (const template of templates) {
        try {
          const templateRef = doc(db, 'landing-templates', template.id);
          const { id, ...templateData } = template;
          await setDoc(templateRef, templateData);
          log(`‚úÖ Created landing template: ${template.name}`, 'success');
        } catch (error) {
          log(`‚ùå Failed to create template ${template.name}: ${error.message}`, 'error');
        }
      }
    }

    async function createAdminTracking() {
      // Card traffic tracking
      const cardTraffic = [
        {
          id: 'traffic-sample-001',
          type: 'card_exchange',
          timestamp: serverTimestamp(),
          participants: {
            initiator: { id: 'attendee-001', type: 'attendee', name: 'John Smith' },
            recipient: { id: 'kitchen-pro-001', type: 'vendor', name: 'Kitchen Pro Design' }
          },
          exchangeDetails: {
            method: 'qr_scan',
            location: { booth: 'A1' },
            notes: 'Interested in kitchen renovation'
          }
        }
      ];

      for (const traffic of cardTraffic) {
        try {
          const trafficRef = doc(db, 'card-traffic', traffic.id);
          const { id, ...trafficData } = traffic;
          await setDoc(trafficRef, trafficData);
          log(`‚úÖ Created card traffic log: ${traffic.id}`, 'success');
        } catch (error) {
          log(`‚ùå Failed to create traffic log ${traffic.id}: ${error.message}`, 'error');
        }
      }

      // Admin analytics
      const analytics = [
        {
          id: 'dashboard-stats',
          totalExchanges: 1,
          totalVendors: 2,
          totalAttendees: 1,
          lastUpdated: serverTimestamp()
        }
      ];

      for (const analytic of analytics) {
        try {
          const analyticRef = doc(db, 'admin-analytics', analytic.id);
          const { id, ...analyticData } = analytic;
          await setDoc(analyticRef, analyticData);
          log(`‚úÖ Created admin analytics: ${analytic.id}`, 'success');
        } catch (error) {
          log(`‚ùå Failed to create analytics ${analytic.id}: ${error.message}`, 'error');
        }
      }
    }

    window.clearResults = function() {
      document.getElementById('results').innerHTML = '';
    };

    // Initialize Firebase when page loads
    initializeFirebase().then(() => {
      log('üöÄ Firebase verification tool ready!', 'success');
      setTimeout(checkAllCollections, 1000);
    });
  </script>
</body>
</html>